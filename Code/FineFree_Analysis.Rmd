---
title: "R Notebook"
output: html_notebook
---

```{r}
# Load relevant libraries
library(dplyr)
library(tidyr)
library(stringr)
library(ggplot2)
library(httr)
library(lubridate)
```

```{r}
token <- read.delim("~/Google Drive File Stream/My Drive/Keys/g_access.txt", stringsAsFactor = FALSE, header = FALSE)
```

```{r}
# Read in current data stored in private github repository
url=paste0("https://raw.githubusercontent.com/OpenDataLiteracy/FinesAndFees/master/Data/DataEntry_MergedDataSet_2019-09-05.csv")
x=GET(url, add_headers(Authorization = paste("token", token, sep = " ")))
finefree <- content(x, type="text/csv", encoding = "UTF-8")
```

```{r}
# help with dates times https://r4ds.had.co.nz/dates-and-times.html
finefree$fine_free_date = as.Date(as_datetime(finefree$fine_free_date))
```

```{r}
finefree %>%
  filter(fine_free_date > "2015-01-01") %>%
  ggplot(aes(x = fine_free_date)) +
  stat_count(geom='col', aes(y=..count..)) +
  scale_x_date(date_breaks = "1 month") +
  theme(axis.text.x = element_text(angle = 75, hjust = 1), axis.title.x=element_blank())
```

```{r}
#https://r4ds.had.co.nz/dates-and-times.html
finefree %>%
  filter(fine_free_date > "2010-01-01") %>%
  count(week = floor_date(fine_free_date, "month")) %>% 
  ggplot(aes(week, n)) +
    geom_line()
```


```{r}
#https://www.earthdatascience.org/courses/earth-analytics/time-series-data/summarize-time-series-by-month-in-r/
finefree %>%
  mutate(month = month(fine_free_date),
         year = year(fine_free_date)) %>%
  group_by(year, month) %>%
  count() 
```

```{r}
finefree %>%
  filter(!is.na(fine_free_date)) %>%
  select(library_name, state, type_of_elimination, fine_free_date) %>%
  arrange(desc(fine_free_date))
```

